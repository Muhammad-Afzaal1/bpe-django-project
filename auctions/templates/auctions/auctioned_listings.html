{% extends "auctions/layout.html" %}

{% block body %}

<div class="container-fluid mt-3">
    <h2 class="mb-4 fw-bold">My Bids & Auctions</h2>

    <!-- Active Bids -->
    <h3 class="mb-3">Active Bids</h3>
    {% if active_bids %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
        {% for listing in active_bids %}
        <div class="col">
            <a class="text-decoration-none text-dark" href="{% url 'listing' id=listing.pk %}">
                <div class="card h-100 shadow-sm border-0 transition-card">
                    <div class="card-img-top-wrapper position-relative"
                        style="height: 200px; overflow: hidden; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa;">
                        {% if listing.image %}
                        <img src="{{listing.image}}" class="card-img-top" alt="{{listing.title}}"
                            style="max-height: 100%; width: auto; max-width: 100%;">
                        {% else %}
                        <span class="text-muted">No Image</span>
                        {% endif %}

                        <!-- Listing Type Badge (Left) -->
                        <span class="position-absolute top-0 start-0 m-2 badge bg-warning text-dark">
                            Auction
                        </span>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold text-truncate">{{listing.title}}</h5>
                        <p class="card-text text-muted small mb-2">Closes: Open</p>
                        <p class="card-text text-truncate">{{listing.description}}</p>

                        <div class="mb-2">
                            {% if listing.average_rating %}
                            <span class="text-warning small">
                                â˜… {{ listing.average_rating }}
                            </span>
                            <span class="text-muted small">
                                ({{ listing.reviews.count }})
                            </span>
                            {% else %}
                            <span class="text-muted small">No ratings</span>
                            {% endif %}
                        </div>

                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span class="small text-muted">Current Price:</span>
                                <span class="fw-bold">${{listing.current_price}}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="small text-muted">Your Max Bid:</span>
                                <span class="fw-bold text-primary">${{listing.user_max_bid}}</span>
                            </div>
                        </div>

                        <div class="mt-auto pt-2">
                            {% if listing.user_max_bid >= listing.current_price %}
                            <span class="badge bg-success w-100">Winning</span>
                            {% else %}
                            <span class="badge bg-warning text-dark w-100">Outbid</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-light mb-5" role="alert">
        You don't have any active bids on ongoing auctions.
    </div>
    {% endif %}

    <!-- Lost Auctions -->
    <h3 class="mb-3">Lost Auctions</h3>
    {% if lost_auctions %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for listing in lost_auctions %}
        <div class="col">
            <a class="text-decoration-none text-dark" href="{% url 'listing' id=listing.pk %}">
                <div class="card h-100 shadow-sm border-0 transition-card opacity-75">
                    <div class="card-img-top-wrapper position-relative"
                        style="height: 200px; overflow: hidden; display: flex; align-items: center; justify-content: center; background-color: #f8f9fa;">
                        {% if listing.image %}
                        <img src="{{listing.image}}" class="card-img-top" alt="{{listing.title}}"
                            style="max-height: 100%; width: auto; max-width: 100%;">
                        {% else %}
                        <span class="text-muted">No Image</span>
                        {% endif %}

                        <!-- Listing Type Badge (Left) -->
                        <span class="position-absolute top-0 start-0 m-2 badge bg-warning text-dark">
                            Auction
                        </span>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold text-truncate">{{listing.title}}</h5>
                        <p class="card-text text-muted small mb-2">Ended on {{listing.date_time|date:"M d, Y"}}</p>

                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span class="small text-muted">Winner Price:</span>
                                <span class="fw-bold">${{listing.current_price}}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="small text-muted">Your Bid:</span>
                                <span
                                    class="fw-bold text-secondary text-decoration-line-through">${{listing.user_max_bid}}</span>
                            </div>
                        </div>

                        <div class="mt-auto pt-2">
                            <span class="badge bg-secondary w-100">Lost</span>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-light" role="alert">
        You haven't lost any auctions (that you participated in).
    </div>
    {% endif %}
</div>

{% endblock %}